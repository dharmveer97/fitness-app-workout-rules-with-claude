generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String
  name          String?
  avatar        String?
  
  // Profile
  age           Int?
  gender        String?
  height        Float?
  weight        Float?
  targetWeight  Float?
  activityLevel String?
  fitnessGoal   String?
  
  // Preferences
  theme         String    @default("auto")
  language      String    @default("en")
  
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  lastLoginAt   DateTime?
  
  // Relations
  workouts      Workout[]
  foodEntries   FoodEntry[]
  challenges    UserChallenge[]
  journalEntries JournalEntry[]
  refreshTokens RefreshToken[]
  
  @@index([email])
}

model RefreshToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([token])
}

model Workout {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name        String
  type        String
  duration    Int      // minutes
  caloriesBurned Int?
  exercises   Json     // Array of exercises
  notes       String?
  
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([date])
}

model FoodEntry {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name        String
  mealType    String   // breakfast, lunch, dinner, snack
  calories    Int
  protein     Float
  carbs       Float
  fats        Float
  servingSize String?
  
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([date])
}

model Challenge {
  id          String   @id @default(cuid())
  title       String
  description String
  type        String
  goal        Int
  unit        String
  duration    Int      // days
  difficulty  String
  icon        String?
  
  startDate   DateTime
  endDate     DateTime
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  participants UserChallenge[]
  
  @@index([startDate])
  @@index([endDate])
}

model UserChallenge {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  challengeId String
  challenge   Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  
  progress    Int      @default(0)
  completed   Boolean  @default(false)
  
  joinedAt    DateTime @default(now())
  completedAt DateTime?
  
  @@unique([userId, challengeId])
  @@index([userId])
  @@index([challengeId])
}

model JournalEntry {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  title       String?
  content     String
  mood        String?
  energy      Int?     // 1-5
  sleep       Float?   // hours
  water       Int?     // glasses
  
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([date])
}
